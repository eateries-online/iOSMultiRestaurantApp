import{_ as Q,l as w,bz as S,P as C,as as h,m as i,n as P,p as d,S as z,f as o,s as r,a3 as f,F as x,V as u,a2 as b,X as c,R as g,aa as T,q as m,aw as U,a4 as A,a5 as D,aV as p,a8 as v,bc as F,bd as E,a9 as _,t as B}from"./index.30bcee2d.js";import{Q as I}from"./QToolbarTitle.80059bbe.js";import{Q as R}from"./QToolbar.8b90f7d3.js";import{Q as j}from"./QHeader.b4bada8e.js";import{Q as y}from"./QImg.4e876ad6.js";import{Q as N}from"./QUploader.e556bff1.js";import{Q as L}from"./QItemLabel.b935a34d.js";import{Q as O}from"./QSelect.a5140148.js";import{Q as H}from"./QSpace.274cde1f.js";import{Q as J}from"./QForm.ab8a2cd2.js";import{Q as X}from"./QPage.f04658ef.js";import{A as k}from"./AppCamera.5768931c.js";import"./QResizeObserver.3c3b4a7a.js";import"./QCircularProgress.f57ffd5b.js";import"./format.2bc25e5f.js";import"./QChip.9a5e9391.js";import"./QMenu.3f2e45b1.js";import"./selection.c88e3f6c.js";import"./rtl.b51694b1.js";import"./vue-i18n.runtime.esm-bundler.4780cb96.js";const G={name:"EditProfile",components:{StepsVerification:w(()=>B(()=>import("./StepsVerification.36fa72d5.js"),["assets/StepsVerification.36fa72d5.js","assets/QSpace.274cde1f.js","assets/index.30bcee2d.js","assets/index.aba08127.css","assets/QToolbar.8b90f7d3.js","assets/QForm.ab8a2cd2.js","assets/QInnerLoading.1dad5a80.js"]))},data(){return{loading:!1,first_name:"",last_name:"",email_address:"",mobile_number:"",mobile_prefix:"",avatar:"",original_email_address:"",original_mobile_number:"",sent_message:"",upload_api:S.api_base_url+"/interface/updateAvatar",upload_enabled:!1,filename:"",upload_path:"",photo_data:""}},setup(){return{DataStore:C()}},created(){this.getCurrentProfile()},computed:{hasData(){return Object.keys(this.photo_data).length>0}},methods:{getCurrentProfile(){const e=h.getUser();e&&(this.original_email_address=e.email_address,this.original_mobile_number=e.contact_number,this.first_name=e.first_name,this.last_name=e.last_name,this.mobile_number=e.contact_number_noprefix,this.mobile_prefix=e.phone_prefix,this.email_address=e.email_address,this.avatar=e.avatar)},checkForm(){let e=!1;this.email_address!==this.original_email_address&&(e=!0),this.mobile_prefix+this.mobile_number!==this.original_mobile_number&&(e=!0),console.log(e),e?(this.loading=!0,i.RequestEmailCode().then(s=>{this.sent_message=s.msg,this.show_modal=!1,this.$refs.steps_verification.show_modal=!0}).catch(s=>{i.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1})):this.onSubmit("")},onSubmit(e){this.loading=!0,i.showLoadingBox("",this.$q);const a={code:e,first_name:this.first_name,last_name:this.last_name,email_address:this.email_address,mobile_number:this.mobile_number,mobile_prefix:this.mobile_prefix,filename:this.filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:""};i.saveProfile(a).then(s=>{this.$refs.steps_verification.show_modal=!1,h.setUser(s.details),i.notify("green",s.msg,"check",this.$q),this.getCurrentProfile()}).catch(s=>{i.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1,i.hideLoadingBox(this.$q)})},afterVerifycode(e){this.onSubmit(e)},getToken(){return h.getToken()},afterUploaded(e){const a=JSON.parse(e.xhr.responseText);a.code===1?(this.avatar=a.details.url_image,this.filename=a.details.filename,this.upload_path=a.details.upload_path):(this.avatar="",this.filename="",this.upload_path="",i.notify("dark",a.msg,"error",this.$q))},takePhoto(){k.isCameraEnabled().then(e=>{k.isFileAccessEnabled().then(a=>{k.getPhoto(1).then(s=>{this.photo_data=s}).catch(s=>{this.photo_data=[]})}).catch(a=>{this.$q.platform.is.ios&&(this.upload_enabled=!this.upload_enabled)})}).catch(e=>{this.$q.platform.is.ios&&(this.upload_enabled=!this.upload_enabled)})},hadData(){return Object.keys(this.photo_data).length>0}}},K={class:"flex flex-center q-mb-md"},M={class:"relative-position"},W={class:"absolute-right",style:{top:"20px",right:"-10px"}};function Y(e,a,s,V,t,n){const $=P("StepsVerification");return d(),z(x,null,[o(j,{reveal:"","reveal-offset":"50",class:f({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[o(R,null,{default:r(()=>[o(u,{onClick:a[0]||(a[0]=l=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",class:"q-mr-sm",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),o(I,{class:"text-weight-bold"},{default:r(()=>[b(c(e.$t("Edit Profile")),1)]),_:1})]),_:1})]),_:1},8,["class"]),o(X,{padding:"",class:f(["q-pl-md q-pr-md row items-stretch",{"bg-mydark ":e.$q.dark.mode,"bg-grey-1 ":!e.$q.dark.mode}])},{default:r(()=>[o(J,{onSubmit:n.checkForm,class:"col-12"},{default:r(()=>[g("div",K,[g("div",M,[o(T,{size:"60px"},{default:r(()=>[n.hasData?(d(),m(y,{key:0,src:t.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover"},null,8,["src"])):(d(),m(y,{key:1,src:t.avatar,class:"fit",fit:"cover","spinner-size":"sm","spinner-color":"primary"},null,8,["src"]))]),_:1}),g("div",W,[e.$q.capacitor?(d(),m(u,{key:0,round:"",color:e.$q.dark.mode?"grey600":"primary","text-color":e.$q.dark.mode?"grey300":"white",icon:"las la-pen",size:"8px",unelevated:"",onClick:n.takePhoto},null,8,["color","text-color","onClick"])):(d(),m(u,{key:1,round:"",color:e.$q.dark.mode?"grey600":"primary","text-color":e.$q.dark.mode?"grey300":"white",icon:"las la-pen",size:"8px",unelevated:"",onClick:a[1]||(a[1]=l=>t.upload_enabled=!t.upload_enabled)},null,8,["color","text-color"]))])])]),t.upload_enabled?(d(),m(N,{key:0,url:t.upload_api,label:e.$t("Upload files"),color:e.$q.dark.mode?"grey600":"primary","text-color":e.$q.dark.mode?"grey300":"white","no-thumbnails":"",class:"full-width q-mb-md",flat:"",accept:".jpg, image/*",bordered:"","max-files":1,"auto-upload":"","max-total-size":"1048576",onRejected:e.onRejectedFiles,headers:[{name:"Authorization",value:`token ${this.getToken()}`}],"field-name":"file",onUploaded:n.afterUploaded},null,8,["url","label","color","text-color","onRejected","headers","onUploaded"])):U("",!0),o(A,{flat:"",class:f({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode})},{default:r(()=>[o(D,null,{default:r(()=>[o(p,{modelValue:t.first_name,"onUpdate:modelValue":a[2]||(a[2]=l=>t.first_name=l),label:e.$t("First name"),outlined:"","lazy-rules":"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",rules:[l=>l&&l.length>0||this.$t("This field is required")]},null,8,["modelValue","label","bg-color","label-color","rules"]),o(p,{modelValue:t.last_name,"onUpdate:modelValue":a[3]||(a[3]=l=>t.last_name=l),label:e.$t("Last name"),outlined:"","lazy-rules":"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",rules:[l=>l&&l.length>0||this.$t("This field is required")]},null,8,["modelValue","label","bg-color","label-color","rules"]),o(p,{modelValue:t.email_address,"onUpdate:modelValue":a[4]||(a[4]=l=>t.email_address=l),label:e.$t("Email address"),outlined:"","lazy-rules":"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",rules:[l=>l&&l.length>0||this.$t("This field is required")]},null,8,["modelValue","label","bg-color","label-color","rules"]),o(p,{modelValue:t.mobile_number,"onUpdate:modelValue":a[6]||(a[6]=l=>t.mobile_number=l),mask:"##############",outlined:"","lazy-rules":"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless",rules:[l=>l&&l.length>0||this.$t("This field is required")]},{prepend:r(()=>[o(O,{dense:"",modelValue:t.mobile_prefix,"onUpdate:modelValue":a[5]||(a[5]=l=>t.mobile_prefix=l),options:V.DataStore.phone_prefix_data,onFilter:e.filterFn,behavior:"dialog","input-debounce":"700",style:{border:"none"},"emit-value":"",borderless:"",class:"myq-field"},{option:r(({itemProps:l,opt:q})=>[o(v,F(E(l)),{default:r(()=>[o(_,{avatar:""},{default:r(()=>[o(y,{src:q.flag,style:{height:"15px","max-width":"20px"}},null,8,["src"])]),_:2},1024),o(_,null,{default:r(()=>[o(L,null,{default:r(()=>[b(c(q.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":r(()=>[o(v,null,{default:r(()=>[o(_,{class:"text-grey"},{default:r(()=>[b(c(e.$t("No results")),1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"])]),_:1},8,["modelValue","bg-color","label-color","rules"])]),_:1})]),_:1},8,["class"]),o(H,{class:"q-pa-sm"}),o(u,{type:"submit",label:e.$t("Save"),unelevated:"","no-caps":"",color:"primary text-white",class:"full-width text-weight-bold",size:"lg",loading:t.loading},null,8,["label","loading"])]),_:1},8,["onSubmit"]),o($,{ref:"steps_verification",sent_message:t.sent_message,onAfterVerifycode:n.afterVerifycode},null,8,["sent_message","onAfterVerifycode"])]),_:1},8,["class"])],64)}var ye=Q(G,[["render",Y]]);export{ye as default};
