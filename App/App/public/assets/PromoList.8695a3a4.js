import{Q as P}from"./QToolbarTitle.80059bbe.js";import{Q as w}from"./QSpace.274cde1f.js";import{_ as k,Q,m as l,p as m,q as u,s as a,f as t,a3 as S,a2 as n,X as i,V as h,a5 as v,R as p,aV as q,aw as $,S as C,U as V,a6 as A,a7 as B,a8 as D,aB as f,a9 as g,F as z,a4 as I,ax as L}from"./index.30bcee2d.js";import{Q as U}from"./QToolbar.8b90f7d3.js";import{Q as N}from"./QForm.ab8a2cd2.js";import{Q as _}from"./QItemLabel.b935a34d.js";import{Q as T}from"./QList.d8ad41f7.js";import{u as x}from"./PromoStore.ec442c4e.js";const F={name:"PromoList",props:["merchant_id","enabled_voucher"],data(){return{promo_code:"",show_modal:!1,loading_apply:!1,loading:!1}},setup(){const o=x(),e=Q();return{PromoStore:o,DataStorePersisted:e}},updated(){this.promo_code=""},created(){this.PromoStore.loadPromo(this.merchant_id)},methods:{showModal(o){this.show_modal=o},usePromo(o){this.loading=!0;const e={cart_uuid:l.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type,currency_code:this.DataStorePersisted.getUseCurrency()};l.applyPromo(e).then(s=>{this.show_modal=!1,this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(s=>{l.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1})},removePromo(o){this.loading=!0;const e={cart_uuid:l.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type};l.removePromo(e).then(s=>{this.show_modal=!1,this.promo_selected=[],this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterRemovepromo")}).catch(s=>{l.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1})},onApplyPromocode(){this.loading_apply=!0;const o={cart_uuid:l.getStorage("cart_uuid"),promo_code:this.promo_code};l.applyPromoCode(o).then(e=>{this.show_modal=!1,this.promo_code="",this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(e=>{l.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_apply=!1})}}},R={class:"row items-center q-col-gutter-sm"},E={class:"col b"},M={class:"col-4"},X={class:"text-weight-bold q-ma-none q-pt-md"};function j(o,e,s,y,d,c){return m(),u(L,{modelValue:d.show_modal,"onUpdate:modelValue":e[2]||(e[2]=r=>d.show_modal=r),position:"bottom"},{default:a(()=>[t(I,null,{default:a(()=>[t(U,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:a(()=>[t(P,{class:S(["text-weight-bold",{"text-white":o.$q.dark.mode,"text-dark":!o.$q.dark.mode}])},{default:a(()=>[n(i(o.$t("Add a promo")),1)]),_:1},8,["class"]),t(w),t(h,{onClick:e[0]||(e[0]=r=>d.show_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),s.enabled_voucher==1?(m(),u(v,{key:0},{default:a(()=>[t(N,{onSubmit:c.onApplyPromocode},{default:a(()=>[p("div",R,[p("div",E,[t(q,{modelValue:d.promo_code,"onUpdate:modelValue":e[1]||(e[1]=r=>d.promo_code=r),label:o.$t("Enter promo code"),outlined:"","lazy-rules":"","bg-color":o.$q.dark.mode?"grey600":"input","label-color":o.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless"},null,8,["modelValue","label","bg-color","label-color"])]),p("div",M,[t(h,{loading:d.loading_apply,type:"submit",unelevated:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:o.$t("Apply"),size:"lg"},null,8,["loading","label"])])])]),_:1},8,["onSubmit"]),p("h6",X,i(o.$t("Available promotions")),1)]),_:1})):$("",!0),t(T,{separator:""},{default:a(()=>[(m(!0),C(z,null,V(y.PromoStore.data[s.merchant_id],r=>A((m(),u(D,{key:r.promo_id,clickable:"",class:"q-mb-sm",onClick:f(b=>c.usePromo(r),["stop"])},{default:a(()=>[t(g,null,{default:a(()=>[t(_,null,{default:a(()=>[n(i(r.title),1)]),_:2},1024),t(_,{caption:"",class:"font11"},{default:a(()=>[n(i(r.sub_title),1)]),_:2},1024),t(_,{caption:"",class:"font11"},{default:a(()=>[n(i(r.valid_to),1)]),_:2},1024)]),_:2},1024),t(g,{side:""},{default:a(()=>[t(h,{onClick:f(b=>c.usePromo(r),["stop"]),loading:d.loading,flat:"",color:o.$q.dark.mode?"secondary":"blue","no-caps":"",label:o.$t("Use now"),dense:"",size:"md"},null,8,["onClick","loading","color","label"])]),_:2},1024)]),_:2},1032,["onClick"])),[[B]])),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var oo=k(F,[["render",j]]);export{oo as default};
