import{_ as w,l as b,t as q,as as v,m as n,n as k,p as i,q as p,s as h,f as o,aV as D,ap as _,a6 as V,V as U,a5 as Q,S as u,a2 as B,X as f,R as T,aw as m,Z as x,F as R,a4 as O,ax as E}from"./index.30bcee2d.js";import{Q as I}from"./QSpace.274cde1f.js";import{Q as N}from"./QToolbar.8b90f7d3.js";import{C as L}from"./ClosePopup.da855ff7.js";import{c as S,f as g,b as y,q as P,w as z,o as A,l as F,g as j,e as H,s as C,d as X,a as Z}from"./FirebaseChat.f9ca35c9.js";const $={name:"ChatSearch",components:{ChatUserList:b(()=>q(()=>import("./ChatUserList.1db93d94.js"),["assets/ChatUserList.1db93d94.js","assets/QItemLabel.b935a34d.js","assets/index.30bcee2d.js","assets/index.aba08127.css","assets/QList.d8ad41f7.js"]))},data(){return{dialog:!1,search:"",is_search:!1,awaitingSearch:!1,search_type:["merchant","admin"],data:[],loading:!0,suggested_data:[],main_user_uuid:""}},mounted(){let e=v.getUser();this.main_user_uuid=e.client_uuid,this.getSuggestedUser()},computed:{hasSearch(){return!n.empty(this.search)},hasData(){return Object.keys(this.data).length>0},getData(){return this.data}},watch:{search(e,a){if(!this.awaitingSearch){if(n.empty(e))return!1;setTimeout(()=>{n.fetchDataChats("searchChats",{search:this.search,search_type:this.search_type}).then(r=>{this.data=r.details}).catch(r=>{this.data=[]}).then(r=>{this.awaitingSearch=!1})},1e3),this.awaitingSearch=!0}}},methods:{whenClear(){this.data=[]},getSuggestedUser(){this.loading=!0,n.fetchDataChats("suggestedUser",{search_type:this.search_type}).then(e=>{this.suggested_data=e.details}).catch(e=>{this.suggested_data=[]}).then(e=>{this.loading=!1})},async onChatuser(e){try{const a=S(g,y.chats),r=P(a,z("participants","array-contains",e),A("lastUpdated","desc"),F(1));let l="";(await j(r)).forEach(s=>{(s.data().participants||null).includes(this.main_user_uuid)===!0&&(l=s.id)}),n.empty(l)?this.createConversation(e):this.loadConversation(l)}catch(a){n.notify("dark",a,"error",this.$q)}},async createConversation(e){try{const r=(await H(S(g,y.chats),{lastUpdated:C()})).id,l=X(g,y.chats,r);let t=this.main_user_uuid,s={lastUpdated:C(),dateCreated:C(),participants:[e,t],isTyping:{[`${e}`]:!1,[`${t}`]:!1}};Z(l,s).then(()=>{this.loadConversation(r)}).catch(d=>{n.notify("dark",d,"error",this.$q)})}catch(a){n.notify("dark",a,"error",this.$q)}},loadConversation(e){this.$router.push({path:"/account/chat/conversation",query:{doc_id:e}})}}},G={key:0,class:"text-body2 text-weight-regular q-mb-md"},J={class:"text-weight-bold"},K={key:1,class:"text-center q-pa-xl"},M={key:0,class:"text-body2 text-center q-pa-xl"};function W(e,a,r,l,t,s){const d=k("ChatUserList");return i(),p(E,{modelValue:t.dialog,"onUpdate:modelValue":a[1]||(a[1]=c=>t.dialog=c),persistent:"",maximized:!0,"transition-show":"fade","transition-hide":"fade",onBeforeShow:a[2]||(a[2]=c=>t.search=""),onBeforeHide:a[3]||(a[3]=c=>t.data=[])},{default:h(()=>[o(O,null,{default:h(()=>[o(N,{class:"q-pl-md q-pr-md q-pt-sm"},{default:h(()=>[o(D,{outlined:"",modelValue:t.search,"onUpdate:modelValue":a[0]||(a[0]=c=>t.search=c),label:e.$t("Search restaurants"),dense:"",color:e.$q.dark.mode?"grey600":"blue","bg-color":e.$q.dark.mode?"grey300":"grey-1",class:"radius10",clearable:"","clear-icon":"close",onClear:s.whenClear},{prepend:h(()=>[o(_,{name:"search"})]),_:1},8,["modelValue","label","color","bg-color","onClear"]),o(I),V(o(U,{flat:"",dense:"",label:e.$t("Cancel"),"no-caps":"",color:e.$q.dark.mode?"grey300":"blue"},null,8,["label","color"]),[[L]])]),_:1}),o(Q,null,{default:h(()=>[s.hasSearch?(i(),u("div",G,[o(_,{name:"search",size:"2em"}),B(f(e.$t("Search for"))+" ",1),T("span",J,f(t.search),1)])):m("",!0),t.awaitingSearch?(i(),u("div",K,[o(x,{color:"primary",size:"2em"})])):m("",!0)]),_:1}),s.hasData&&!t.awaitingSearch?(i(),p(d,{key:0,data:t.data,onOnChatuser:s.onChatuser},null,8,["data","onOnChatuser"])):(i(),u(R,{key:1},[s.hasSearch&&!t.awaitingSearch?(i(),u("div",M,f(e.$t("No matching records found")),1)):m("",!0)],64)),s.hasSearch?m("",!0):(i(),p(d,{key:2,data:t.suggested_data,headerTitle:e.$t("Suggested Restaurants"),onOnChatuser:s.onChatuser},null,8,["data","headerTitle","onOnChatuser"]))]),_:1})]),_:1},8,["modelValue"])}var re=w($,[["render",W]]);export{re as default};
